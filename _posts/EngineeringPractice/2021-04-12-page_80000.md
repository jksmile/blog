---
title: Log-Studio工程实践与演进
author: J.K
date: 2021-04-12 15:00:00 +0800
categories: [总结, 工程实践]
tags: [日志, 日志组件]
---

## 1.背景现状

&emsp;&emsp;&emsp;&emsp;近些年随着容器化的普及应用，架构体系从微服务、云原生步步升级，工程日志不再是简简单单的纠查排错运维。更多的是承载着
Logging、Tracing、Metrics、Topology等方面的任务。经过大量的工程实践，以ELK为代表的日志处理方案几乎完美地整合了日志抓取、搜索和展示几个方面的
需求，是目前业界最流行的日志处理解决方案。在诸多工程项目应用中，在数据处理环境，主要是针对日志date、level、traceId等头部通用数据的提取，对于
message部分的转换处理，通常将其作为整段处理或者针对不同项目情况做特定的pattern进行解析，最终将数据扔给ES去进行检索。

![日志收集](/assets/img/2021/log-elk-001.png "ELK")

&emsp;&emsp;&emsp;&emsp;在工程层    面上，一方面由于message部分的信息因为没有规范化的标准，日志文件中的业务日志信息更是五花八门，比如：PHP
项目工程中将一个数组$array直接输出到日志文件中，Java工程中将一个JavaBean直接toString()输出的。这些问题在应用Runtime阶段带来性能上的问题，同
时给后续的智能运维体系工作带来非常大的阻力。另一方面现体系中业务监控是基于日志进行策略处理，但日志管理与监控平台通过人工关联，随着后续项目的快速迭代
发展，监控平台的规则维护难以持续。

    logback.xml 示例：

    <configuration>
    　　　　　　<appender name="APP" class="ch.qos.logback.core.FileAppender">
    　　　　　　　　<file>app-biz.log</file>
    　　　　　　　　<append>true</append>
    　　　　　　　　<encoder>
    　　　　　　　　　　<pattern>%date|%thread|%X{traceId}|%msg|%n</pattern>
                    <charset>UTF-8</charset>
    　　　　　　　　</encoder>
    　　　　　　</appender>

    　　　　　　<root level="INFO">
    　　　　　　<appender-ref ref="APP" />
    　　　　　　</root>
    </configuration>

   **总结现有工程日志现状存在的弊端及潜在需求：**

   * [代码规范]：日志与业务代码混编，不便于项目日志维护
   * [日志标准]：日志格式不利于后续日志接入及解析工作
   * [链路分析]：跨服务存在日志断链情况，不便于排查问题
   * [安全风险]：日志存在敏感字段加密需要上层处理，存在风险
   * [故障排查]：依赖debug日志排查，日志级别动态调整
   * [工程运维]：基于日志的业务报警需要人工运维，不可持续

## 2.目标分析

**我们希望在工程层面尽可能的解决后顾之忧，为此我们需要探讨以下几个问题：**

&emsp;&emsp;&emsp;&emsp;**(1)** ETL机制在日志工程方面实践问题。根据我们目前现状，随着接入项目的递增、日TPS的增长，以下问题将突显：
   * [突显问题1]：日志解析模板维护将难以持续
   * [突显问题2]：transfer服务横向野蛮增长

&emsp;&emsp;&emsp;&emsp;从机器资源投入角度出发，数据加工处理的便利性取决于数据源的质量（规范+标准），大多实践工程的普遍做法是在transfer阶段
对收集的数据进行结构化处理，为此需要付出的代价不仅仅是无效处理增加、机器资源浪费，更多的是同等量级下的高延时。从另一个角度出发，如果我们能在Extract
阶段对数据源头标准化、规范化萃取是不是可以更好的解决以上两个突显的问题？

&emsp;&emsp;&emsp;&emsp;**(2)** 日志报警与工程pipeline问题。基于日志关键字报警机制，RD手工将日志信息与报警平台进行关联操作，将存在以下问题：
   * [周期管理]：DEV阶段与OPS阶段不连续
   * [报警规则]：容易造成无效报警规则堆积
   * [报警质量]：报警泛滥导致运维成本增加

&emsp;&emsp;&emsp;&emsp;是不是将工程日志上报到报警平台就能解决面临的问题？工程日志的最佳管理实践在Local还是Remote？

&emsp;&emsp;&emsp;&emsp;**(3)** 服务运维能力问题。



&emsp;&emsp;&emsp;&emsp;**(4)** 日志信息安全问题。

## 3.解决方案

## 4.总结
