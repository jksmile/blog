---
title: Log-Studio工程实践与演进
author: J.K
date: 2021-04-12 15:00:00 +0800
categories: [总结, 工程实践]
tags: [日志, 日志组件]
---

## 背景及现状

&emsp;&emsp;近些年随着容器化的普及应用，架构体系从微服务、云原生步步升级，工程日志不再是简简单单的纠查排错运维，更多的是承载着Logging、Tracing、
Metrics、Topology等方面的任务。经过大量的工程实践，以ELK为代表的日志处理方案几乎完美地整合了日志抓取、搜索和展示几个方面的需求，是目前业界最流行
的日志处理解决方案。在诸多工程项目应用中，在数据处理环境，主要是针对日志date、level、traceId等头部通用数据的提取，对于message部分的转换处理，通
常将其作为整段处理或者针对不同项目情况做特定的pattern进行解析，最终将数据扔给ES去进行检索。

![日志收集](/assets/img/2021/log-elk-001.png "ELK")

&emsp;&emsp;在工程层    面上，一方面由于message部分的信息因为没有规范化的标准，日志文件中的业务日志信息更是五花八门，比如：PHP项目工程中将一个数组
$array直接输出到日志文件中，Java工程中将一个JavaBean直接toString()输出的。这些问题在应用Runtime阶段带来性能上的问题，同时给后续的智能运维体
系工作带来非常大的阻力。另一方面现体系中业务监控是基于日志进行策略处理，但日志管理与监控平台通过人肉关联，随着后续项目的快速迭代发展，监控平台的规则
维护难以持续。

    logback.xml 示例：

    <configuration>
    　　　　　　<appender name="APP" class="ch.qos.logback.core.FileAppender">
    　　　　　　　　<file>app-biz.log</file>
    　　　　　　　　<append>true</append>
    　　　　　　　　<encoder>
    　　　　　　　　　　<pattern>%date|%thread|%X{traceId}|%msg|%n</pattern>
                    <charset>UTF-8</charset>
    　　　　　　　　</encoder>
    　　　　　　</appender>

    　　　　　　<root level="INFO">
    　　　　　　<appender-ref ref="APP" />
    　　　　　　</root>
    </configuration>

   **总结现有工程日志现状存在的弊端及潜在需求：**

   * 日志与业务代码混编，不便于项目日志维护
   * 日志格式不利于后续日志接入及解析工作
   * 跨服务存在日志断链情况，不便于排查问题
   * 基于日志的业务报警需要人工运维，不可持续
   * 日志中敏感字段加密需要上层处理，存在风险
   * 依赖debug日志排查，不能动态调整日志级别

&emsp;&emsp;



